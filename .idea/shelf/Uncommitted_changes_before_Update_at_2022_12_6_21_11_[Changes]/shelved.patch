Index: app/src/main/java/com/example/can301/service/ForegroundWhiteNoiseServiceOnBind.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.can301.service;\r\n\r\nimport android.app.Notification;\r\nimport android.app.NotificationChannel;\r\nimport android.app.NotificationManager;\r\nimport android.app.PendingIntent;\r\nimport android.app.Service;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.ServiceConnection;\r\nimport android.graphics.BitmapFactory;\r\nimport android.graphics.Color;\r\nimport android.media.MediaPlayer;\r\nimport android.os.Binder;\r\nimport android.os.Handler;\r\nimport android.os.IBinder;\r\nimport android.os.Looper;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.ImageButton;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.core.app.NotificationCompat;\r\n\r\nimport com.example.can301.R;\r\nimport com.example.can301.adapter.NoiseListAdapter;\r\nimport com.example.can301.entity.NoiseItem;\r\nimport com.example.can301.receiver.NotificationClickReceiver;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\n\r\npublic class ForegroundWhiteNoiseServiceOnBind extends Service implements MediaPlayer.OnCompletionListener {\r\n    @Override\r\n    public int onStartCommand(Intent intent, int flags, int startId) {\r\n        return super.onStartCommand(intent, flags, startId);\r\n    }\r\n\r\n    private final WhiteNoiseBinder binder = new WhiteNoiseBinder();\r\n//    to save system resource, i will not instantiate all the mediaPlayer.\r\n    private MediaPlayer singleMediaPlayer;\r\n    private static final int NOTIFICATION_DOWNLOAD_PROGRESS_ID = 0x0001;\r\n\r\n    @Override\r\n    public void onCompletion(MediaPlayer mediaPlayer) {\r\n        mediaPlayer.start();\r\n    }\r\n\r\n    public class WhiteNoiseBinder extends Binder {\r\n        public ForegroundWhiteNoiseServiceOnBind getService(){\r\n            return ForegroundWhiteNoiseServiceOnBind.this;\r\n        }\r\n    }\r\n    public ForegroundWhiteNoiseServiceOnBind() {\r\n        super();\r\n    }\r\n\r\n\r\n    @Override\r\n    public void onCreate() {\r\n        super.onCreate();\r\n        Log.d(ForegroundWhiteNoiseServiceOnBind.this.getClass().getName(), \"onCreate: \");\r\n    }\r\n//        int[] mediaResources = NoiseItem.getMediaResourceArray();\r\n//        for (int mediaResource : mediaResources) {\r\n//            MediaPlayer mediaPlayer = MediaPlayer.create(this, mediaResource);\r\n////            mediaPlayer.setOnCompletionListener(this);\r\n//            mediaPlayer.setLooping(true);\r\n//            mediaPlayerList.add(mediaPlayer);\r\n//        }\r\n\r\n    public void switchNoise(View view,ImageButton lastOne){\r\n        if(singleMediaPlayer.isPlaying()){\r\n            pauseNoise(view,lastOne);\r\n        }else {\r\n            continueNoise(view,lastOne);\r\n        }\r\n    }\r\n\r\n    public void startNewNoise(NoiseItem noiseItem,View view, ImageButton lastOne){\r\n        try {\r\n            new Thread(new Runnable() {\r\n                @Override\r\n                public void run() {\r\n                    if (lastOne == null){\r\n                        stopForeground(false);\r\n                        singleMediaPlayer = MediaPlayer.create(getApplicationContext(),noiseItem.mediaResource);\r\n                        singleMediaPlayer.setLooping(true);\r\n                        singleMediaPlayer.start();\r\n                        ((ImageButton)view).setBackgroundResource(R.mipmap.icons8_pause_100);\r\n                        NoiseListAdapter.setView((ImageButton) view,noiseItem.title);\r\n                        createNotification(noiseItem);\r\n                    }else {\r\n                        stopForeground(false);\r\n                        singleMediaPlayer.stop();\r\n                        singleMediaPlayer = MediaPlayer.create(getApplicationContext(),noiseItem.mediaResource);\r\n                        singleMediaPlayer.setLooping(true);\r\n                        singleMediaPlayer.start();\r\n                        ((ImageButton)view).setBackgroundResource(R.mipmap.icons8_pause_100);\r\n                        lastOne.setBackgroundResource(R.mipmap.icons8_play_100);\r\n                        NoiseListAdapter.setView((ImageButton) view, noiseItem.title);\r\n                        createNotification(noiseItem);\r\n                    }\r\n                }\r\n            }).start();\r\n        }catch (Exception e){\r\n            e.printStackTrace();\r\n        }\r\n\r\n    }\r\n\r\n    public void pauseNoise(View view,ImageButton lastOne){\r\n        try {\r\n            new Thread(new Runnable() {\r\n                @Override\r\n                public void run() {\r\n                    singleMediaPlayer.pause();\r\n                    new Handler(Looper.getMainLooper()).post(new Runnable() {\r\n                        public void run() {\r\n                            ((ImageButton)view).setBackgroundResource(R.mipmap.icons8_play_100);\r\n                            NoiseListAdapter.setNull();\r\n                            stopForeground(true);\r\n                        }\r\n                    });\r\n                }\r\n            }).start();\r\n        }catch (Exception e){\r\n            e.printStackTrace();\r\n        }\r\n\r\n    }\r\n    public void continueNoise(View view,ImageButton lastOne){\r\n        try {\r\n            new Thread(new Runnable() {\r\n                @Override\r\n                public void run() {\r\n                    singleMediaPlayer.start();\r\n                    new Handler(Looper.getMainLooper()).post(new Runnable() {\r\n                        public void run() {\r\n                            ((ImageButton)view).setBackgroundResource(R.mipmap.icons8_pause_100);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }catch (Exception e){\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public IBinder onBind(Intent intent) {\r\n        return binder;\r\n    }\r\n\r\n\r\n    @Override\r\n    public void onDestroy() {\r\n        if(singleMediaPlayer!=null){\r\n//            if (singleMediaPlayer.isPlaying()) {\r\n//                singleMediaPlayer.stop();\r\n//            }\r\n            singleMediaPlayer.release();\r\n        }\r\n        NoiseListAdapter.setNull();\r\n        stopForeground(true);\r\n        super.onDestroy();\r\n        Log.d(ForegroundWhiteNoiseServiceOnBind.this.getClass().getName(), \"onDestroy: \");\r\n    }\r\n\r\n    @Override\r\n    public boolean onUnbind(Intent intent) {\r\n        if(singleMediaPlayer!=null){\r\n//            if (singleMediaPlayer.isPlaying()) {\r\n//                singleMediaPlayer.stop();\r\n//            }\r\n            singleMediaPlayer.release();\r\n        }\r\n        NoiseListAdapter.setNull();\r\n        stopForeground(true);\r\n        return super.onUnbind(intent);\r\n    }\r\n\r\n    public void createNotification(NoiseItem noiseItem){\r\n        String CHANNEL_ONE_ID = \"com.primedu.cn\";\r\n        String CHANNEL_ONE_NAME = \"Channel One\";\r\n        NotificationChannel notificationChannel = null;\r\n        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.O) {\r\n            notificationChannel = new NotificationChannel(CHANNEL_ONE_ID,\r\n                    CHANNEL_ONE_NAME, NotificationManager.IMPORTANCE_HIGH);\r\n            notificationChannel.enableLights(true);\r\n            notificationChannel.setLightColor(Color.RED);\r\n            notificationChannel.setShowBadge(true);\r\n            notificationChannel.setLockscreenVisibility(Notification.VISIBILITY_PUBLIC);\r\n            NotificationManager manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);\r\n            manager.createNotificationChannel(notificationChannel);\r\n        }\r\n        //使用兼容版本\r\n        NotificationManager notificationManager = (NotificationManager) this.getSystemService(Context.NOTIFICATION_SERVICE);\r\n        NotificationCompat.Builder builder=new NotificationCompat.Builder(this);\r\n        //设置状态栏的通知图标\r\n        builder.setSmallIcon(R.mipmap.icons8_pause_50);\r\n        //设置通知栏横条的图标\r\n        builder.setLargeIcon(BitmapFactory.decodeResource(getResources(),noiseItem.image));\r\n        //禁止用户点击删除按钮删除\r\n        builder.setAutoCancel(true);\r\n        //禁止滑动删除\r\n        builder.setOngoing(true);\r\n        //右上角的时间显示\r\n        builder.setShowWhen(true);\r\n        //设置通知栏的标题内容\r\n        builder.setContentTitle(\"The music \\\"\"+noiseItem.title+\"\\\" is Playing\");\r\n        builder.setChannelId(CHANNEL_ONE_ID);\r\n        Intent intent =new Intent (this, NotificationClickReceiver.class);\r\n        PendingIntent pendingIntent = PendingIntent.getBroadcast(this, 0, intent, 0);\r\n        //创建通知\r\n        Notification notification = builder.build();\r\n        //设置为前台服务\r\n        startForeground(NOTIFICATION_DOWNLOAD_PROGRESS_ID,notification);\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/can301/service/ForegroundWhiteNoiseServiceOnBind.java b/app/src/main/java/com/example/can301/service/ForegroundWhiteNoiseServiceOnBind.java
--- a/app/src/main/java/com/example/can301/service/ForegroundWhiteNoiseServiceOnBind.java	(revision 0d77afd7abbf155fce8ede737af6ab8421f08de5)
+++ b/app/src/main/java/com/example/can301/service/ForegroundWhiteNoiseServiceOnBind.java	(date 1670332159971)
@@ -25,7 +25,7 @@
 import com.example.can301.R;
 import com.example.can301.adapter.NoiseListAdapter;
 import com.example.can301.entity.NoiseItem;
-import com.example.can301.receiver.NotificationClickReceiver;
+//import com.example.can301.receiver.NotificationClickReceiver;
 
 import java.util.ArrayList;
 import java.util.HashMap;
@@ -211,8 +211,8 @@
         //设置通知栏的标题内容
         builder.setContentTitle("The music \""+noiseItem.title+"\" is Playing");
         builder.setChannelId(CHANNEL_ONE_ID);
-        Intent intent =new Intent (this, NotificationClickReceiver.class);
-        PendingIntent pendingIntent = PendingIntent.getBroadcast(this, 0, intent, 0);
+//        Intent intent =new Intent (this, NotificationClickReceiver.class);
+//        PendingIntent pendingIntent = PendingIntent.getBroadcast(this, 0, intent, 0);
         //创建通知
         Notification notification = builder.build();
         //设置为前台服务
Index: app/src/main/AndroidManifest.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\">\r\n\r\n    <uses-permission android:name=\"android.permission.INTERNET\" />\r\n    <uses-permission android:name=\"android.permission.WAKE_LOCK\" />\r\n    <uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" />\r\n    <uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\"/>\r\n\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/Theme.CAN301\"\r\n        android:usesCleartextTraffic=\"true\">\r\n        <service\r\n            android:name=\".service.ForegroundWhiteNoiseServiceOnBind\"\r\n            android:enabled=\"true\"\r\n            android:exported=\"false\" />\r\n\r\n        <receiver\r\n            android:name=\".receiver.NotificationClickReceiver\">\r\n        </receiver>\r\n\r\n        <activity\r\n            android:name=\".mainTestActivity\"\r\n            android:exported=\"false\" />\r\n        <activity\r\n            android:name=\".TableActivity\"\r\n            android:exported=\"false\">\r\n            <meta-data\r\n                android:name=\"android.app.lib_name\"\r\n                android:value=\"\" />\r\n        </activity>\r\n        <activity\r\n            android:name=\".LoginActivity\"\r\n            android:exported=\"false\"/>\r\n        <activity\r\n            android:name=\".RegisterActivity\"\r\n            android:exported=\"false\" />\r\n        <activity\r\n            android:name=\".QRcode\"\r\n            android:exported=\"false\">\r\n            <meta-data\r\n                android:name=\"android.app.lib_name\"\r\n                android:value=\"\" />\r\n        </activity>\r\n        <activity\r\n            android:name=\".TutorialActivity\"\r\n            android:exported=\"true\"\r\n            android:screenOrientation=\"portrait\"\r\n            >\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n\r\n            <meta-data\r\n                android:name=\"android.app.lib_name\"\r\n                android:value=\"\" />\r\n        </activity>\r\n    </application>\r\n\r\n</manifest>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
--- a/app/src/main/AndroidManifest.xml	(revision 0d77afd7abbf155fce8ede737af6ab8421f08de5)
+++ b/app/src/main/AndroidManifest.xml	(date 1670332134309)
@@ -19,9 +19,9 @@
             android:enabled="true"
             android:exported="false" />
 
-        <receiver
-            android:name=".receiver.NotificationClickReceiver">
-        </receiver>
+<!--        <receiver-->
+<!--            android:name=".receiver.NotificationClickReceiver">-->
+<!--        </receiver>-->
 
         <activity
             android:name=".mainTestActivity"
Index: app/src/main/java/com/example/can301/receiver/NotificationClickReceiver.java
===================================================================
diff --git a/app/src/main/java/com/example/can301/receiver/NotificationClickReceiver.java b/app/src/main/java/com/example/can301/receiver/NotificationClickReceiver.java
deleted file mode 100644
--- a/app/src/main/java/com/example/can301/receiver/NotificationClickReceiver.java	(revision 0d77afd7abbf155fce8ede737af6ab8421f08de5)
+++ /dev/null	(revision 0d77afd7abbf155fce8ede737af6ab8421f08de5)
@@ -1,24 +0,0 @@
-package com.example.can301.receiver;
-
-import android.content.BroadcastReceiver;
-import android.content.Context;
-import android.content.Intent;
-import android.os.Bundle;
-
-import com.example.can301.mainTestActivity;
-
-public class NotificationClickReceiver extends BroadcastReceiver {
-
-    @Override
-    public void onReceive(Context context, Intent intent) {
-        Intent newIntent = new Intent(context, mainTestActivity.class);
-        //跳转到主界面后，并将栈底的Activity全部都销毁
-        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
-        //向MainActivity中传入这个值
-        Bundle bundle = new Bundle();
-        bundle.putBoolean("toNoise",true);
-        intent.putExtras(bundle);
-        context.startActivity(intent);
-
-    }
-}
\ No newline at end of file
Index: app/src/main/java/com/example/can301/TableActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.can301;\r\n\r\nimport android.app.Activity;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.content.res.Resources;\r\nimport android.os.Build;\r\nimport android.os.Bundle;\r\nimport android.view.Gravity;\r\nimport android.view.View;\r\nimport android.view.Window;\r\nimport android.widget.Button;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.RequiresApi;\r\n\r\nimport com.example.can301.net.NetAgent;\r\nimport com.example.can301.net.OkHttpUtils;\r\nimport com.example.can301.utilities.FastJsonUtils;\r\n\r\nimport java.time.LocalDate;\r\nimport java.time.ZoneId;\r\nimport java.util.ArrayList;\r\nimport java.util.Date;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\npublic class TableActivity extends Activity {\r\n    private int startIndex;\r\n    private int seatNumber;\r\n    private String type;\r\n    private TextView testTV;\r\n    private ImageView[] seatList;\r\n    private int[] seatStatus;\r\n    private ArrayList<Integer> seatIDs;\r\n    private String backendUrl;\r\n    private int taken = 0;\r\n    private int ava = 0;\r\n    private int unk = 0;\r\n    private Button checkinBtn;\r\n    private TextView tableStats;\r\n    @RequiresApi(api = Build.VERSION_CODES.O)\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        seatIDs = new ArrayList<Integer>();\r\n        // 隐藏标题栏\r\n        requestWindowFeature(Window.FEATURE_NO_TITLE);\r\n        //setContentView(R.layout.activity_table_v);\r\n        backendUrl = \"http://47.94.44.163:8080\";\r\n        Intent intent = getIntent();\r\n        Bundle infoBundle = intent.getExtras();\r\n        // 在res中获取\r\n            Resources res =getResources();\r\n            String[] typeArray= res.getStringArray(R.array.tableType);\r\n        startIndex = Integer.parseInt(\r\n                infoBundle.getString(\"startIndex\"));\r\n        seatNumber = Integer.parseInt(\r\n                infoBundle.getString(\"seatNumber\"));;\r\n        type = infoBundle.getString(\"type\");\r\n\r\n        if(type.equals(\"0\"))\r\n            setContentView(R.layout.activity_table_v);\r\n        else if(type.equals(\"1\"))\r\n            setContentView(R.layout.activity_table_h);\r\n        else\r\n            setContentView(R.layout.activity_table_sqr);\r\n        checkinBtn = findViewById(R.id.checkinBtn);\r\n        testTV = findViewById(R.id.testView);\r\n        testTV.setText(type + \",\" + startIndex + \", \" + seatNumber);\r\n        tableStats = findViewById(R.id.tableStats);\r\n        seatList = new ImageView[seatNumber];\r\n        findSeat();\r\n        //\r\n        try{\r\n            initSeatStatus();\r\n        }\r\n        catch (Exception e){\r\n            e.printStackTrace();\r\n        }\r\n        checkinBtn.setOnClickListener(this::onCheckInClick);\r\n        assignSeatBtn(seatList);\r\n        readID();\r\n    }\r\n\r\n    private void gainCoin(String id, int credit){\r\n            HashMap hashMap = new HashMap();\r\n            hashMap.put(\"id\", id);\r\n            hashMap.put(\"salary\", String.valueOf(credit));\r\n            //System.out.println(getActivity());\r\n            OkHttpUtils.getSoleInstance().doPostForm(backendUrl + \"/user/getcash/\", new NetAgent() {\r\n                @Override\r\n                public void onSuccess(String result) {\r\n                    Map<String, String> map = FastJsonUtils.stringToCollect(result);\r\n                    String cash = String.valueOf(map.get(\"cash\"));\r\n                    if (map.get(\"status\").equals(\"200\")) {\r\n                        //Toast.makeText(getActivity().getApplicationContext(), \"get cash\", Toast.LENGTH_SHORT).show();\r\n                    } else {\r\n                        Toast toastCenter = Toast.makeText(getApplicationContext(), \"no\", Toast.LENGTH_SHORT);\r\n                        toastCenter.setGravity(Gravity.CENTER, 0, 0);\r\n                        toastCenter.show();\r\n                    }\r\n                }\r\n                @Override\r\n                public void onError(Exception e) {\r\n                        e.printStackTrace();\r\n                        Toast center = Toast.makeText(getApplicationContext(), \"network failure\", Toast.LENGTH_SHORT);\r\n                        center.setGravity(Gravity.CENTER, 0, 0);\r\n                        center.show();\r\n                }\r\n            },hashMap,this);\r\n    }\r\n\r\n    @RequiresApi(api = Build.VERSION_CODES.O)\r\n    public static boolean isSameDay(Date date1, Date date2) {\r\n        LocalDate localDate1 = date1.toInstant()\r\n                .atZone(ZoneId.systemDefault())\r\n                .toLocalDate();\r\n        LocalDate localDate2 = date2.toInstant()\r\n                .atZone(ZoneId.systemDefault())\r\n                .toLocalDate();\r\n        return localDate1.isEqual(localDate2);\r\n    }\r\n\r\n    @RequiresApi(api = Build.VERSION_CODES.O)\r\n    private void onCheckInClick(View view) {\r\n        int credit = 0;\r\n        String userid = \"1\";\r\n        SharedPreferences userpref = getSharedPreferences(\"config\", MODE_PRIVATE);\r\n        userid = userpref.getString(\"id\", \"1\");\r\n        SharedPreferences mypref = getSharedPreferences(\"tab\", MODE_PRIVATE);\r\n        int checkCount = mypref.getInt(\"checkCount\", 0);\r\n        Date currdate = new Date(); //or simply new Date();\r\n        Date archivedDate = new Date(mypref.getLong(\"date\", 0));\r\n\r\n        //!\r\n        // one seat 5 credits by checkin Commit (max 25), global time recorded, uncomment condition to activate date detection\r\n        if(!isSameDay(currdate,archivedDate)){\r\n            String stringStatus =  mypref.getString(\"statuslist\", \"null\");\r\n            for (int i = startIndex; i < startIndex+seatNumber; i++) {\r\n                if(seatStatus[i] != Integer.parseInt(stringStatus.substring(i-startIndex,i-startIndex+1))){\r\n                    credit += 5;\r\n                }\r\n            }\r\n            if (credit > 25) credit = 25;\r\n/*            int old_ava = mypref.getInt(\"available\", 0);\r\n            int old_unk = mypref.getInt(\"unknown\", 0);\r\n            int old_tak = mypref.getInt(\"taken\", 0);*/\r\n            long millis = currdate.getTime();\r\n            SharedPreferences.Editor editor = mypref.edit();\r\n            editor.putLong(\"date\", millis);\r\n            checkCount += 1;\r\n            editor.putInt(\"checkCount\", checkCount);\r\n            editor.apply();\r\n            gainCoin(userid, credit);\r\n            Toast.makeText(getApplicationContext(), \"you earned \" + credit + \"!\", Toast.LENGTH_SHORT).show();\r\n            Intent intent = new Intent(TableActivity.this, mainTestActivity.class);\r\n            startActivity(intent);\r\n        }\r\n        else {\r\n            Toast.makeText(getApplicationContext(), \"You have taken todays credit!\", Toast.LENGTH_SHORT).show();\r\n            Intent intent = new Intent(TableActivity.this, mainTestActivity.class);\r\n            startActivity(intent);\r\n        }\r\n\r\n        //System.out.println(old_tak + \", \" + old_ava + \", \"+ old_unk + \", \" + stringStatus + \", \" + myDate);\r\n    }\r\n\r\n    private void findSeat(){\r\n        // 数组越界了就看这里\r\n        int j = 0;\r\n        for (int i = 1; i < seatNumber+1; i++) {\r\n            String seatID = \"seat\" + i;;\r\n            //System.out.println(seatID);\r\n            int resID = getResources().getIdentifier(seatID, \"id\", getPackageName());\r\n            // System.out.println(resID);\r\n            seatIDs.add(resID);\r\n            ImageView seat = (ImageView) findViewById(resID);\r\n            //System.out.println(seat.toString());\r\n            seatList[j] = seat;\r\n            j++;\r\n        }\r\n    }\r\n\r\n    private void assignSeatBtn(@NonNull ImageView[] seatList){\r\n        for (ImageView seat: seatList) {\r\n            seat.setOnClickListener(this::onSeatClick);\r\n        }\r\n    }\r\n\r\n    private void onSeatClick(View view) {\r\n        int id = view.getId();\r\n        int specSeatIdx = startIndex;\r\n        for (int i = 0; i<seatIDs.size(); i++) {\r\n            if(id == seatIDs.get(i)){\r\n                specSeatIdx += i;\r\n            }\r\n        }\r\n        changeSeatStatus(specSeatIdx+1,999);\r\n        getSeatStatus();\r\n    }\r\n\r\n    private void initSeatStatus(){\r\n        taken = 0;\r\n        ava = 0;\r\n        unk = 0;\r\n        HashMap hashMap = new HashMap();\r\n        OkHttpUtils.getSoleInstance().doPostForm(backendUrl + \"/seat/listseat\", new NetAgent() {\r\n            @Override\r\n            public void onSuccess(String result) {\r\n                Map<String, String> map = FastJsonUtils.stringToCollect(result);\r\n                String status = map.get(\"status\");\r\n                String message = map.get(\"status\");\r\n                String a = map.get(\"seatstatus\");\r\n                String statusKey = \"\";\r\n                Object[] b = FastJsonUtils.toArray(a);\r\n                int[] ss = new int[b.length];\r\n                for (int i = 0; i < ss.length; i++) {\r\n                    ss[i] = Integer.parseInt(b[i].toString());\r\n                    statusKey += b[i].toString();\r\n                }\r\n                seatStatus = ss;\r\n                // System.out.println(seatStatus);\r\n                if (status.equals(\"200\")) {\r\n                } else {\r\n                    Toast toastCenter = Toast.makeText(getApplicationContext(), message, Toast.LENGTH_SHORT);\r\n                    toastCenter.setGravity(Gravity.CENTER, 0, 0);\r\n                    toastCenter.show();\r\n                }\r\n                int bias=0;\r\n                for (ImageView seat: seatList) {\r\n                    if(seatStatus[startIndex+bias]==0){\r\n                        taken++;\r\n                        seat.setImageDrawable(getDrawable(R.drawable.redseat));\r\n                    }\r\n                    else if(seatStatus[startIndex+bias]==1){\r\n                        ava++;\r\n                        seat.setImageDrawable(getDrawable(R.drawable.greenseat));\r\n                    }\r\n                    else if(seatStatus[startIndex+bias]==2){\r\n                        unk++;\r\n                        seat.setImageDrawable(getDrawable(R.drawable.grayseat));\r\n                    }else{\r\n                        seat.setImageDrawable(getDrawable(R.drawable.grayseat));\r\n                        unk++;\r\n                    }\r\n                    bias++;\r\n                }\r\n                tableStats.setText(\"// \"+ taken + \" taken, \" + ava + \" available, \"+ unk +\" unknown. //\");\r\n                SharedPreferences mypref = getSharedPreferences(\"tab\", MODE_PRIVATE);\r\n                SharedPreferences.Editor editor = mypref.edit();\r\n                editor.putString(\"statuslist\", statusKey.substring(startIndex, startIndex + seatNumber));\r\n                editor.putInt(\"available\", ava);\r\n                editor.putInt(\"unknown\", unk);\r\n                editor.putInt(\"taken\", taken);\r\n                editor.apply();\r\n            }\r\n            @Override\r\n            public void onError(Exception e) {\r\n                e.printStackTrace();\r\n                Toast center = Toast.makeText(getApplicationContext(), \"network failure\", Toast.LENGTH_SHORT);\r\n                center.setGravity(Gravity.CENTER, 0, 0);\r\n                center.show();\r\n            }\r\n        },hashMap,this);\r\n    }\r\n\r\n    private void getSeatStatus(){\r\n        taken = 0;\r\n        ava = 0;\r\n        unk = 0;\r\n        HashMap hashMap = new HashMap();\r\n        OkHttpUtils.getSoleInstance().doPostForm(backendUrl + \"/seat/listseat\", new NetAgent() {\r\n            @Override\r\n            public void onSuccess(String result) {\r\n                Map<String, String> map = FastJsonUtils.stringToCollect(result);\r\n                String status = map.get(\"status\");\r\n                String message = map.get(\"status\");\r\n                String a = map.get(\"seatstatus\");\r\n                Object[] b = FastJsonUtils.toArray(a);\r\n                int[] ss = new int[b.length];\r\n                for (int i = 0; i < ss.length; i++) {\r\n                    ss[i] = Integer.parseInt(b[i].toString());\r\n                }\r\n                seatStatus = ss;\r\n                // System.out.println(seatStatus);\r\n                if (status.equals(\"200\")) {\r\n                    //Toast.makeText(getApplicationContext(), \"Updated seat info\", Toast.LENGTH_SHORT).show();\r\n                } else {\r\n                }\r\n                int bias=0;\r\n                for (ImageView seat: seatList) {\r\n                    if(seatStatus[startIndex+bias]==0){\r\n                        taken++;\r\n                        seat.setImageDrawable(getDrawable(R.drawable.redseat));\r\n                    }\r\n                    else if(seatStatus[startIndex+bias]==1){\r\n                        ava++;\r\n                        seat.setImageDrawable(getDrawable(R.drawable.greenseat));\r\n                    }\r\n                    else if(seatStatus[startIndex+bias]==2){\r\n                        unk++;\r\n                        seat.setImageDrawable(getDrawable(R.drawable.grayseat));\r\n                    }else{\r\n                        seat.setImageDrawable(getDrawable(R.drawable.grayseat));\r\n                        unk++;\r\n                    }\r\n                    bias++;\r\n                }\r\n                tableStats.setText(\"// \"+ taken + \" taken, \" + ava + \" available, \"+ unk +\" unknown. //\");\r\n            }\r\n            @Override\r\n            public void onError(Exception e) {\r\n                e.printStackTrace();\r\n                Toast center = Toast.makeText(getApplicationContext(), \"network failure\", Toast.LENGTH_SHORT);\r\n                center.setGravity(Gravity.CENTER, 0, 0);\r\n                center.show();\r\n            }\r\n        },hashMap,this);\r\n\r\n    }\r\n    private void changeSeatStatus(int id,int qrresult){\r\n        HashMap hashMap = new HashMap();\r\n        hashMap.put(\"seatIndex\",String.valueOf(id));\r\n        hashMap.put(\"qrresult\",String.valueOf(qrresult));\r\n        OkHttpUtils.getSoleInstance().doPostForm(backendUrl + \"/seat/changeSteatStatus\", new NetAgent() {\r\n            @Override\r\n            public void onSuccess(String result) {\r\n                Map<String, String> map = FastJsonUtils.stringToCollect(result);\r\n                String status = map.get(\"status\");\r\n                if (status.equals(\"200\")) {\r\n                } else {\r\n                }\r\n                getSeatStatus();\r\n            }\r\n            @Override\r\n            public void onError(Exception e) {\r\n                e.printStackTrace();\r\n                Toast center = Toast.makeText(getApplicationContext(), \"network failure\", Toast.LENGTH_SHORT);\r\n                center.setGravity(Gravity.CENTER, 0, 0);\r\n                center.show();\r\n            }\r\n        },hashMap,this);\r\n\r\n    }\r\n\r\n    public void readID(){\r\n        SharedPreferences mypref = getSharedPreferences(\"config\", MODE_PRIVATE);\r\n        String id = mypref.getString(\"id\", \"id = x\");\r\n        testTV.setText(\"id = \" + id);\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/can301/TableActivity.java b/app/src/main/java/com/example/can301/TableActivity.java
--- a/app/src/main/java/com/example/can301/TableActivity.java	(revision 0d77afd7abbf155fce8ede737af6ab8421f08de5)
+++ b/app/src/main/java/com/example/can301/TableActivity.java	(date 1670318741133)
@@ -116,14 +116,9 @@
 
     @RequiresApi(api = Build.VERSION_CODES.O)
     public static boolean isSameDay(Date date1, Date date2) {
-        LocalDate localDate1 = date1.toInstant()
-                .atZone(ZoneId.systemDefault())
-                .toLocalDate();
-        LocalDate localDate2 = date2.toInstant()
-                .atZone(ZoneId.systemDefault())
-                .toLocalDate();
-        return localDate1.isEqual(localDate2);
-    }
+            int days = (int) ((date2.getTime() - date1.getTime()) / (1000 * 3600 * 24));
+            return days < 1;
+        }
 
     @RequiresApi(api = Build.VERSION_CODES.O)
     private void onCheckInClick(View view) {
@@ -132,10 +127,11 @@
         SharedPreferences userpref = getSharedPreferences("config", MODE_PRIVATE);
         userid = userpref.getString("id", "1");
         SharedPreferences mypref = getSharedPreferences("tab", MODE_PRIVATE);
-        int checkCount = mypref.getInt("checkCount", 0);
         Date currdate = new Date(); //or simply new Date();
         Date archivedDate = new Date(mypref.getLong("date", 0));
-
+        long millis = currdate.getTime();
+        SharedPreferences.Editor editor = mypref.edit();
+        editor.putLong("date", millis);
         //!
         // one seat 5 credits by checkin Commit (max 25), global time recorded, uncomment condition to activate date detection
         if(!isSameDay(currdate,archivedDate)){
@@ -146,17 +142,11 @@
                 }
             }
             if (credit > 25) credit = 25;
-/*            int old_ava = mypref.getInt("available", 0);
+            int old_ava = mypref.getInt("available", 0);
             int old_unk = mypref.getInt("unknown", 0);
-            int old_tak = mypref.getInt("taken", 0);*/
-            long millis = currdate.getTime();
-            SharedPreferences.Editor editor = mypref.edit();
-            editor.putLong("date", millis);
-            checkCount += 1;
-            editor.putInt("checkCount", checkCount);
-            editor.apply();
+            int old_tak = mypref.getInt("taken", 0);
             gainCoin(userid, credit);
-            Toast.makeText(getApplicationContext(), "you earned " + credit + "!", Toast.LENGTH_SHORT).show();
+            Toast.makeText(getApplicationContext(), "you earned " + credit, Toast.LENGTH_SHORT).show();
             Intent intent = new Intent(TableActivity.this, mainTestActivity.class);
             startActivity(intent);
         }
@@ -194,9 +184,15 @@
     private void onSeatClick(View view) {
         int id = view.getId();
         int specSeatIdx = startIndex;
+        String staticSeatId = "";
+        int status = 0;
+        int localID = 0;
         for (int i = 0; i<seatIDs.size(); i++) {
             if(id == seatIDs.get(i)){
                 specSeatIdx += i;
+                staticSeatId = "seat" + (i+1);
+                status = seatStatus[startIndex+i];
+                localID = i;
             }
         }
         changeSeatStatus(specSeatIdx+1,999);
